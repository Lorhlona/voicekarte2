# 音声からカルテを自動生成するアプリケーション

## 概要

このプロジェクトは、音声を録音して OpenAI の API を使用し、患者のカルテを自動生成する Web アプリケーションです。医療現場でのカルテ作成を効率化し、医師の負担を軽減することを目的としています。

## 主な機能

- **音声の録音と保存**
- **音声データのテキスト変換（トランスクリプション）**
- **初診・再診に対応したカルテの自動生成**
- **カルテの表示、コピー、クリア機能**
- **システムプロンプトや OpenAI API キーの設定編集機能**

## OpenAI API キーの取得

[OpenAI API キーの取得](https://platform.openai.com/docs/api-reference/introduction)

[OpenAIのAPIキー取得方法|2024年7月最新版|料金体系や注意事項](https://qiita.com/kurata04/items/a10bdc44cc0d1e62dad3)

## 一般ユーザー向けインストール手順

### Windows版

1. **アプリケーションのダウンロード**
   - [ZIPでダウンロード](https://github.com/Lorhlona/voicekarte2/archive/refs/heads/main.zip)して解凍します。

2. **インストールと起動**
   - 解凍したフォルダ内の`install.bat`を実行（歯車アイコン）
     - 必要なパッケージのインストールが行われます
   - その後、`app.bat`を実行してアプリを起動
   - ブラウザが自動的に起動します（起動まで少し時間がかかります）

3. **終了方法**
   - アプリの終了ボタンでサーバーを安全に終了
   - その後、ウィンドウとターミナルを閉じる

### Mac版

1. **アプリケーションのダウンロード**
   - [ZIPでダウンロード](https://github.com/Lorhlona/voicekarte2/archive/refs/heads/main.zip)して解凍
   - または以下のコマンドでクローン：
     ```bash
     git clone https://github.com/Lorhlona/voicekarte2.git
     cd voicekarte2
     ```

2. **開発環境での起動**
   ```bash
   # 開発モードでの起動
   npm install
   npm run dev

   # 本番モードでの起動
   npm install
   npm run build
   npm run start
   ```

3. **アプリケーションへのアクセス**
   - ブラウザで [http://localhost:3000](http://localhost:3000) にアクセス

## 使い方

1. **録音開始**
    - 「録音開始」ボタンをクリックし、患者の症状や状態を話してください。

2. **録音停止**
    - 録音が完了したら「録音停止」ボタンをクリックします。

3. **音声ファイルのアップロード**
    - 「ファイルアップロード」ボタンをクリックして、任意の音声ファイル（例：iPhoneのボイスレコードでつくったm4aファイルなど）を選択してください。

4. **カルテ作成**
    - 初診の場合：「初診カルテ作成」ボタンをクリック
    - 再診の場合：「再診カルテ作成」ボタンをクリック
    - 録音またはアップロードした音声がテキストに変換され、OpenAI API を使用してカルテが自動生成されます。

5. **カルテの操作**
    - **コピー**：「コピー」ボタンで生成されたカルテをクリップボードにコピーできます。
    - **クリア**：「クリア」ボタンで音声データやカルテ内容をリセットします。このため患者さんのデータはPC上には残りません

6. **設定変更**
    - 「設定」ボタンから以下の設定が行えます：
        - 初診カルテシステムプロンプト編集：先生の普段の診療録を例示してあげると、よりカルテが正確になります。
        - 再診カルテシステムプロンプト編集：先生の普段の診療録を例示してあげると、よりカルテが正確になります。
        - OpenAI APIキー設定

7. **終了**
    - 終わるときはこのボタンを必ず押し、サーバーを終了させてから、ウィンドウとターミナルを閉じてください。

## 注意事項

- **OpenAI API キーの管理**：API キーは個人情報です。第三者に共有しないようご注意ください。
- **API 利用料金**：OpenAI API の利用には料金が発生します。事前に利用料金をご確認ください。
- **動作確認**：本アプリケーションはローカル環境での動作を前提としています。

## 開発者向け情報

### 必要な開発環境

- **Node.js**（推奨バージョン 14 以上）
  - インストール方法：[nvmを使用してNode.jsをインストール](https://qiita.com/ymzkjpx/items/9658709eb51a23121098)
- **npm** または **yarn**

### 使用技術

- **フロントエンド**：Next.js, React, Material-UI (MUI), Tailwind CSS
- **バックエンド**：Next.js API Routes
- **その他**：OpenAI API

### ディレクトリ構成

- `/components`：React コンポーネント
- `/pages/api`：API ルート
- `/utils`：ユーティリティ関数
- `/hooks`：カスタムフック
- `/config`：設定ファイル

### 主なファイル

- `components/medical-chart-app.tsx`：メインのアプリケーションコンポーネント
- `utils/api.ts`：API 呼び出し用の関数
- `pages/api/uploadAudio.ts`：音声アップロード用の API エンドポイント
- `pages/api/generateRecord.ts`：カルテ生成用の API エンドポイント

### 依存関係の更新

```bash
# 依存関係の更新
npm update

# 依存関係のアップグレード
npx npm-check-updates -u
npm install
```

## ライセンス

このコードはMITライセンスの下で提供されています。商用利用を含め、自由に使用・改変していただけます。

## コントリビューション

バグの報告や機能の提案は Issues や Pull Requests を通じて受け付けています。ご協力よろしくお願いいたします。
